<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Symbiotic Flyer Maker</title>
    <link rel="icon" href="logo.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        :root {
            --primary: #CDB296;
            --secondary: #8B5A2B;
            --dark: #2A2A2A;
            --light: #F9F6F2;
            --text-font: 'Space Grotesk', sans-serif;
            --text-size: 24px;
            --name-size: 16px;
            --text-color: #3C2F20;
            --glass-bg: rgba(205, 178, 150, 0.7);
            --glass-border: rgba(255, 255, 255, 0.3);
            --name-bottom-margin: 25px;
            --text-weight: 400;
            --name-weight: 300;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --border-radius: 20px;
            --maroon: #5c233e;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--text-font);
            background: linear-gradient(135deg, #CDB296 0%, #A67B5B 100%);
            color: var(--dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 20px 10px;
        }

        nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            padding: 10px;
            box-shadow: var(--shadow);
            flex-wrap: wrap;
            justify-content: center;
        }

        nav button {
            padding: 10px 20px;
            border: none;
            background: transparent;
            color: var(--dark);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            min-height: 44px;
        }

        nav button.active {
            background: var(--primary);
            color: white;
        }

        nav button:hover {
            background: var(--primary);
            color: white;
        }

        .tab-content {
            display: none;
            width: 100%;
            max-width: 600px;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(20px);
            animation: fadeInScale 0.6s ease-out forwards;
            position: relative;
        }

        @keyframes fadeInScale {
            0% {
                opacity: 0;
                transform: scale(0.95);
            }

            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .app-title {
            font-size: 28px;
            font-weight: 700;
            text-align: center;
            color: #000000;
            margin: 0 auto; 
        }

        #displayCanvas,
        .thread-canvas,
        #idCanvas {
            width: 100%;
            height: auto;
            border-radius: 12px;
            border: 2px solid var(--glass-border);
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, rotate 0.3s ease;
        }

        #displayCanvas:hover,
        .thread-canvas:hover,
        #idCanvas:hover,
        #displayCanvas:active,
        .thread-canvas:active,
        #idCanvas:active {
            transform: scale(1.02) rotate(1deg);
        }

        .input-group {
            width: 100%;
            margin-bottom: 10px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            font-weight: 600;
            color: var(--dark);
        }

        .font-weight-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .font-weight-option {
            padding: 10px 18px;
            border-radius: 10px;
            border: 2px solid var(--glass-border);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 14px;
            background: var(--light);
            touch-action: manipulation;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .font-weight-option:hover,
        .font-weight-option:active {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
        }

        .font-weight-option.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        textarea,
        input[type="text"],
        input[type="number"],
        input[type="file"] {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 2px solid rgba(0, 0, 0, 0.1);
            background: var(--light);
            color: var(--dark);
            font-family: var(--text-font);
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
            min-height: 44px;
        }

        textarea:focus,
        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="file"]:focus {
            border-color: var(--primary);
            background: #ffffff;
            box-shadow: 0 0 0 3px rgba(205, 178, 150, 0.2);
        }

        textarea {
            height: 80px;
            resize: none;
            min-height: 80px;
        }

        input[type="text"],
        input[type="number"],
        input[type="file"] {
            height: 45px;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--secondary);
            outline: none;
            -webkit-appearance: none;
            touch-action: pan-y;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #FFFFFF;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover,
        input[type="range"]::-webkit-slider-thumb:active {
            transform: scale(1.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #FFFFFF;
            cursor: pointer;
            border: none;
        }

        .button-group {
            display: flex;
            gap: 10px;
            width: 100%;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            padding: 14px;
            border: 2px solid transparent;
            border-radius: 10px;
            font-family: var(--text-font);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            touch-action: manipulation;
            min-width: 120px;
            min-height: 44px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover,
        .btn-primary:active {
            background: var(--dark);
            box-shadow: 0 8px 20px rgba(205, 178, 150, 0.3);
            transform: scale(1.05);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            border-color: var(--dark);
        }

        .btn-secondary:hover,
        .btn-secondary:active {
            background: var(--dark);
            color: white;
            transform: scale(1.05);
        }

        #hiddenCanvas {
            display: none;
        }

        .template-selector {
            width: 100%;
            margin-bottom: 15px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .template-scroll {
            display: flex;
            gap: 10px;
            padding: 6px;
        }

        .template-header {
            min-width: 150px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary);
            color: white;
            font-weight: bold;
            font-size: 14px;
            flex-shrink: 0;
            border-radius: 10px;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
        }

        .template-option {
            min-width: 100px;
            height: 70px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid var(--glass-border);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            flex-shrink: 0;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.5s ease-out forwards;
        }

        .template-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .template-option.active-template {
            border: 4px solid var(--maroon);
        }

        .template-option:hover {
            transform: scale(1.05);
        }

        @keyframes slideIn {
            0% {
                opacity: 0;
                transform: translateX(20px);
            }

            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
</head>

<body>

    <nav>
        <button class="tab-button active" data-tab="id"><i class="fas fa-id-card"></i> ID</button>
        <button class="tab-button" data-tab="tweet"><i class="fab fa-twitter"></i> Tweet</button>
        <button class="tab-button" data-tab="thread"><i class="fas fa-list"></i> Thread</button>
    </nav>

    <div id="id" class="tab-content active container">
        <div class="header">
            <h1 class="app-title">Symbiotic Flyer Maker - ID</h1>
        </div>

        <canvas id="idCanvas" width="500" height="500"></canvas>

        <div class="input-group">
            <label for="idName">Your Name</label>
            <input type="text" id="idName" placeholder="Enter your name" oninput="drawIDCard()">
        </div>

        <div class="input-group">
            <label for="profilePicture">Upload Profile Picture</label>
            <input type="file" id="profilePicture" accept="image/*" onchange="drawIDCard()">
        </div>
        
        <div class="button-group">
            <button class="btn-primary" onclick="downloadImage('idCanvas', 'symbiotic_id')"><i class="fas fa-download"></i> Download Image</button>
            <button class="btn-secondary" onclick="shareToX('idCanvas', 'ID')"><i class="fab fa-twitter"></i> Share to X</button>
        </div>
    </div>

    <div id="tweet" class="tab-content container">
        <div class="header">
            <h1 class="app-title">Symbiotic Flyer Maker - Tweet</h1>
        </div>
        
        <canvas id="displayCanvas" width="500" height="500"></canvas>

        <div class="template-selector">
            <label>Select Background Template</label>
            <div class="template-scroll" id="tweetTemplates">
                </div>
        </div>

        <div class="input-group">
            <label for="tweetBody">Tweet Text</label>
            <textarea id="tweetBody" oninput="drawCanvas()"></textarea>
        </div>

        <div class="input-group">
            <label for="tweetFontSize">Font Size: <span id="fontSizeValue">24</span>px</label>
            <input type="range" id="tweetFontSize" min="16" max="60" value="24" oninput="document.getElementById('fontSizeValue').textContent = this.value; drawCanvas()">
        </div>

        <label>Text Weight</label>
        <div class="font-weight-selector" id="tweetWeightSelector">
            <span class="font-weight-option active" data-weight="300">Light</span>
            <span class="font-weight-option" data-weight="400">Regular</span>
            <span class="font-weight-option" data-weight="700">Bold</span>
        </div>

        <div class="button-group">
            <button class="btn-primary" onclick="downloadImage('displayCanvas', 'symbiotic_tweet')"><i class="fas fa-download"></i> Download Image</button>
            <button class="btn-secondary" onclick="shareToX('displayCanvas', 'Tweet')"><i class="fab fa-twitter"></i> Share to X</button>
        </div>
    </div>

    <div id="thread" class="tab-content container">
        <div class="header">
            <h1 class="app-title">Symbiotic Flyer Maker - Thread</h1>
        </div>

        <div id="thread-canvases">
            </div>

        <div class="template-selector">
            <label>Select Background Template</label>
            <div class="template-scroll" id="threadTemplates">
                </div>
        </div>
        
        <div class="input-group">
            <label for="threadText">Thread Text (New line for new image)</label>
            <textarea id="threadText" oninput="drawThread()"></textarea>
        </div>
        
        <div class="input-group">
            <label for="threadFontSize">Font Size: <span id="threadFontSizeValue">24</span>px</label>
            <input type="range" id="threadFontSize" min="16" max="60" value="24" oninput="document.getElementById('threadFontSizeValue').textContent = this.value; drawThread()">
        </div>
        
        <label>Text Weight</label>
        <div class="font-weight-selector" id="threadWeightSelector">
            <span class="font-weight-option active" data-weight="300">Light</span>
            <span class="font-weight-option" data-weight="400">Regular</span>
            <span class="font-weight-option" data-weight="700">Bold</span>
        </div>

        <div class="button-group">
            <button class="btn-primary" onclick="downloadThreadImages()"><i class="fas fa-download"></i> Download All Images</button>
            <button class="btn-secondary" onclick="alert('This feature will download all images. You will have to manually upload and post them as a thread on X.')"><i class="fab fa-twitter"></i> Share to X</button>
        </div>
    </div>

    <script>
        const TWEET_TEMPLATES = [
            'flyer1.jpg', 'flyer2.jpg', 'flyer3.jpg', 
            'flyer4.jpg', 'flyer5.jpg', 'flyer6.jpg'
        ];
        let activeTemplate = TWEET_TEMPLATES[0];
        let tweetFontWeight = '300';
        let threadFontWeight = '300';

        // --- Utility Functions ---

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');

            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            document.querySelector(`.tab-button[data-tab="${tabId}"]`).classList.add('active');

            // Redraw content when switching tabs
            if (tabId === 'id') {
                drawIDCard();
            } else if (tabId === 'tweet') {
                drawCanvas();
            } else if (tabId === 'thread') {
                drawThread();
            }
        }

        function downloadImage(canvasId, filename) {
            const canvas = document.getElementById(canvasId);
            const link = document.createElement('a');
            link.download = filename + '.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        function shareToX(canvasId, type) {
            const canvas = document.getElementById(canvasId);
            const imageData = canvas.toDataURL('image/png').split(',')[1];
            const text = `Check out my new Symbiotic ${type} Flyer!\n\n#Symbiotic #FlyerMaker`;
            
            // Note: Sharing images directly via X/Twitter Web Intent is not possible without an API key/server.
            // This button is kept for UI consistency but provides an alert for manual sharing.
            alert(`Ready to share! Download the image and manually upload it to X/Twitter with this text:\n\n${text}`);
        }
        
        // --- Template Setup ---
        
        function setupTemplates() {
            const tweetContainer = document.getElementById('tweetTemplates');
            const threadContainer = document.getElementById('threadTemplates');

            TWEET_TEMPLATES.forEach((template, index) => {
                const isIdTemplate = template.startsWith('id'); // ID logic removed, but keeping a check for safety
                
                // Create for Tweet Tab
                const tweetOption = document.createElement('div');
                tweetOption.className = `template-option ${index === 0 ? 'active-template' : ''}`;
                tweetOption.setAttribute('data-template', template);
                tweetOption.innerHTML = `<img src="${template}" alt="Flyer Template ${index + 1}">`;
                tweetOption.onclick = () => {
                    setActiveTemplate(template, 'tweet');
                };
                tweetContainer.appendChild(tweetOption);
                
                // Create for Thread Tab
                const threadOption = document.createElement('div');
                threadOption.className = `template-option ${index === 0 ? 'active-template' : ''}`;
                threadOption.setAttribute('data-template', template);
                threadOption.innerHTML = `<img src="${template}" alt="Flyer Template ${index + 1}">`;
                threadOption.onclick = () => {
                    setActiveTemplate(template, 'thread');
                };
                threadContainer.appendChild(threadOption);
            });
        }

        function setActiveTemplate(template, tabType) {
            activeTemplate = template;
            document.querySelectorAll(`#${tabType} .template-option`).forEach(option => {
                option.classList.remove('active-template');
                if (option.getAttribute('data-template') === template) {
                    option.classList.add('active-template');
                }
            });
            if (tabType === 'tweet') {
                drawCanvas();
            } else if (tabType === 'thread') {
                drawThread();
            }
        }
        
        // --- ID Card Drawing Logic ---

        function drawIDCard() {
            const canvas = document.getElementById('idCanvas');
            const ctx = canvas.getContext('2d');
            const nameText = document.getElementById('idName').value.toUpperCase() || 'YOUR NAME';
            const profilePictureInput = document.getElementById('profilePicture');
            const profilePictureFile = profilePictureInput.files[0];

            // Set a high resolution for a clear image (e.g., 1080x1080)
            canvas.width = 1080;
            canvas.height = 1080;

            // --- 1. Load Background Image (Crucial Step) ---
            const bgImg = new Image();
            // Assumes the ID background is named 'id.jpg'
            bgImg.src = 'id.jpg'; 
            
            // Use a promise to wait for the image to load
            new Promise((resolve) => {
                bgImg.onload = () => resolve();
                bgImg.onerror = () => {
                    console.error("ID background image (id.jpg) failed to load. Drawing only text.");
                    resolve(); 
                };
                if (bgImg.complete) resolve();
            }).then(() => {
                
                // Clear canvas and draw background
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                if (bgImg.complete && bgImg.width > 0) {
                    ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);
                } else {
                     // Fallback to a solid color if image fails
                    ctx.fillStyle = 'rgba(205, 178, 150, 0.9)'; 
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }

                // --- 2. Draw Symbiotic Logo (Your Request) ---
                const logo = new Image();
                logo.src = 'logo.png'; 
                
                logo.onload = function() {
                    const logoSize = 150; 
                    const logoX = 150;    
                    const logoY = 150;    

                    ctx.drawImage(logo, logoX, logoY, logoSize, logoSize);
                    drawCardText(); 
                };

                logo.onerror = function() {
                    console.error("Logo image (logo.png) failed to load.");
                    drawCardText();
                };
                
                // If logo is already cached, draw immediately
                if (logo.complete) {
                    const logoSize = 150;
                    const logoX = 150;
                    const logoY = 150;
                    ctx.drawImage(logo, logoX, logoY, logoSize, logoSize);
                    drawCardText();
                } else {
                    drawCardText(); 
                }
                
            });

            // Helper function to draw all the text elements
            function drawCardText() {
                ctx.textAlign = 'center';
                ctx.fillStyle = 'black'; 

                // 1. Draw "Symbiotic for community" (Your Request)
                ctx.font = '500 50px "Space Grotesk"';
                ctx.fillText("Symbiotic for community", canvas.width / 2, 850); 

                // 2. Draw the User's Name
                ctx.font = '700 80px "Space Grotesk"';
                ctx.fillText(nameText, canvas.width / 2, 950); 
                
                // 3. Draw the profile picture (if uploaded)
                if (profilePictureFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = new Image();
                        img.onload = function() {
                            const picSize = 400;
                            const picX = canvas.width / 2 - picSize / 2;
                            const picY = 300;
                            
                            // Clip the profile picture to a circle
                            ctx.save();
                            ctx.beginPath();
                            ctx.arc(canvas.width / 2, picY + picSize / 2, picSize / 2, 0, Math.PI * 2, true);
                            ctx.closePath();
                            ctx.clip();
                            
                            ctx.drawImage(img, picX, picY, picSize, picSize);
                            ctx.restore();
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(profilePictureFile);
                }
            }
        }
        
        // --- Tweet Canvas Drawing Logic ---

        function drawCanvas() {
            const canvas = document.getElementById('displayCanvas');
            const ctx = canvas.getContext('2d');
            const text = document.getElementById('tweetBody').value || 'Enter your tweet text here...';
            const fontSize = document.getElementById('tweetFontSize').value;
            const fontWeight = tweetFontWeight;

            canvas.width = 1080;
            canvas.height = 1080;

            const bgImg = new Image();
            bgImg.src = activeTemplate;

            bgImg.onload = function() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);

                ctx.fillStyle = 'white'; 
                ctx.font = `${fontWeight} ${fontSize}px "Space Grotesk"`;
                ctx.textAlign = 'center';

                wrapText(ctx, text, canvas.width / 2, canvas.height / 2, canvas.width * 0.8, fontSize * 1.2);
            };
            bgImg.onerror = function() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'gray';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '300 40px "Space Grotesk"';
                ctx.textAlign = 'center';
                ctx.fillText('Error: Background image failed to load.', canvas.width / 2, canvas.height / 2);
            };

            // If the image is already loaded (cached), draw immediately
            if (bgImg.complete) {
                bgImg.onload(); 
            }
        }

        // Helper function for wrapping text
        function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
            const words = text.split(' ');
            let line = '';
            let lines = [];

            for (let n = 0; n < words.length; n++) {
                const testLine = line + words[n] + ' ';
                const metrics = ctx.measureText(testLine);
                const testWidth = metrics.width;

                if (testWidth > maxWidth && n > 0) {
                    lines.push(line);
                    line = words[n] + ' ';
                } else {
                    line = testLine;
                }
            }
            lines.push(line);

            // Center the block of text vertically
            const totalTextHeight = lines.length * lineHeight;
            let currentY = y - totalTextHeight / 2 + lineHeight / 2;

            for (let i = 0; i < lines.length; i++) {
                ctx.fillText(lines[i].trim(), x, currentY);
                currentY += lineHeight;
            }
        }
        
        // --- Thread Drawing Logic ---

        function drawThread() {
            const container = document.getElementById('thread-canvases');
            const text = document.getElementById('threadText').value.trim();
            const fontSize = document.getElementById('threadFontSize').value;
            const fontWeight = threadFontWeight;
            const lines = text.split('\n').filter(line => line.trim() !== '');

            container.innerHTML = ''; // Clear previous canvases

            if (lines.length === 0) {
                // Draw a blank placeholder if no text is present
                const placeholderCanvas = document.createElement('canvas');
                placeholderCanvas.className = 'thread-canvas';
                placeholderCanvas.width = 500;
                placeholderCanvas.height = 500;
                container.appendChild(placeholderCanvas);

                const ctx = placeholderCanvas.getContext('2d');
                ctx.fillStyle = 'lightgray';
                ctx.fillRect(0, 0, 500, 500);
                ctx.fillStyle = 'darkgray';
                ctx.font = '300 20px "Space Grotesk"';
                ctx.textAlign = 'center';
                ctx.fillText('Enter text above to generate thread images.', 250, 250);
                return;
            }

            lines.forEach((lineText, index) => {
                const canvas = document.createElement('canvas');
                canvas.className = 'thread-canvas';
                // Use a standard large size for better quality
                canvas.width = 1080;
                canvas.height = 1080; 
                container.appendChild(canvas);

                const ctx = canvas.getContext('2d');
                const bgImg = new Image();
                bgImg.src = activeTemplate; 

                bgImg.onload = function() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);

                    ctx.fillStyle = 'white'; 
                    ctx.font = `${fontWeight} ${fontSize}px "Space Grotesk"`;
                    ctx.textAlign = 'center';

                    // Use the same wrapping logic as the tweet
                    wrapText(ctx, lineText.trim(), canvas.width / 2, canvas.height / 2, canvas.width * 0.8, fontSize * 1.2);
                };
                
                if (bgImg.complete) {
                    bgImg.onload(); 
                }
            });
        }
        
        // Function to download all thread images as a ZIP (requires an external library or server-side code normally)
        function downloadThreadImages() {
            const canvases = document.querySelectorAll('#thread-canvases .thread-canvas');
            if (canvases.length === 0) {
                alert('No thread images to download. Please enter text in the thread box.');
                return;
            }

            // Simple download loop (no ZIP, just downloads files individually)
            canvases.forEach((canvas, index) => {
                const link = document.createElement('a');
                link.download = `symbiotic_thread_part_${index + 1}.png`;
                link.href = canvas.toDataURL('image/png');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });
            alert(`Downloaded ${canvases.length} thread images.`);
        }

        // --- Event Listeners and Initial Setup ---

        document.addEventListener('DOMContentLoaded', () => {
            // Setup Tab Switching
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    switchTab(button.getAttribute('data-tab'));
                });
            });

            // Setup Tweet Font Weight
            document.getElementById('tweetWeightSelector').querySelectorAll('.font-weight-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.getElementById('tweetWeightSelector').querySelectorAll('.font-weight-option').forEach(o => o.classList.remove('active'));
                    option.classList.add('active');
                    tweetFontWeight = option.getAttribute('data-weight');
                    drawCanvas();
                });
            });

            // Setup Thread Font Weight
            document.getElementById('threadWeightSelector').querySelectorAll('.font-weight-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.getElementById('threadWeightSelector').querySelectorAll('.font-weight-option').forEach(o => o.classList.remove('active'));
                    option.classList.add('active');
                    threadFontWeight = option.getAttribute('data-weight');
                    drawThread();
                });
            });

            setupTemplates();

            // Initial Draw for the active tab (ID)
            drawIDCard(); 
        });
    </script>
</body>
</html>
